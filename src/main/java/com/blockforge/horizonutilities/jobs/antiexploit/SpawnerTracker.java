package com.blockforge.horizonutilities.jobs.antiexploit;

import org.bukkit.NamespacedKey;
import org.bukkit.entity.Entity;
import org.bukkit.persistence.PersistentDataType;
import org.bukkit.plugin.java.JavaPlugin;

/**
 * Tags mobs that were spawned by a spawner so the kill listener can apply
 * the configured spawner pay multiplier.
 * <p>
 * Uses entity PersistentDataContainer (available on Spigot 1.14+).
 */
public class SpawnerTracker {

    private static final String KEY_NAME = "spawner_mob";

    private final NamespacedKey spawnerKey;

    public SpawnerTracker(JavaPlugin plugin) {
        this.spawnerKey = new NamespacedKey(plugin, KEY_NAME);
    }

    /**
     * Marks {@code entity} as a spawner-sourced mob. Call this from a
     * {@code SpawnerSpawnEvent} handler.
     */
    public void markSpawnerMob(Entity entity) {
        entity.getPersistentDataContainer().set(spawnerKey, PersistentDataType.BYTE, (byte) 1);
    }

    /**
     * Returns {@code true} if this entity was spawned by a spawner.
     */
    public boolean isSpawnerMob(Entity entity) {
        return entity.getPersistentDataContainer().has(spawnerKey, PersistentDataType.BYTE);
    }
}
